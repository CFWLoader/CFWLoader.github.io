---
title: Effective C++(一)
date: 2017-12-06 15:29:56
tags:
	- C++
	- Effective C++
categories: C++技术
---

Scott Meyers的`Effective C++`是C++程序员推荐的读物之一，其中充满了作者的总结出来的编程经验，当年笔者刚入门编程的时候一口气从谭浩强的《C语言编程》开始，《C Primer》、《C++ Primer Plus》等等加起来有10本书学习了如何在C++下编程。当年读这本书的时候也不具备什么具体的编程实践，除了做了书上的一些代码的实验之外，无非也就是在平时的编程中有意地使用书中的编程技巧。时至今日，笔者目前的工作虽然不是以C++来编写实践项目，像一般的`Web`项目优先考虑的是快捷的`Java`开发，但是学过的编程技巧却是跨越语言的。并且从这几年的学习编程的经验来看，真正对自己编程能力有真正提升的并不是学习了XX语言。

现在总结起来，笔者的编程能力有了突变式的提升是在大一下学期有一门《数据结构》，学习每种经典的数据结构时，笔者对ADT(Abstract Data Type,抽象数据类型)毫无招架之力，书中对这些经典的数据结构(栈、队列等)有一个抽象的描述，用脑子想似乎很正常，但是在具体实现时常常不知从何下手，除了一遍一遍地抄书上的代码实践之外抄到熟之外别无他法。这样下来，锻炼到遇到一个问题下来，首先是问题的分解，分解到可以直接想到这部分的代码该是什么样子的，把每个最小的部分想好之后向上整合，形成解决整个问题的具体思路。

到了后来实践具体项目的时候，客户的需求描述比课本的描述更加抽象，更多的是靠工程经验想像出客户的期望，也有实际的工程工具(软件开发模型等)帮助项目的一步一步实现。终归到底，依靠的还是问题分解。

笔者虽然已经读过了`Effective C++`，也在这几年中生搬硬套应用过书中的知识，多少都有了些心得，于是在打算在这段较为空闲的时间中写下，也算是复习这本书。

## 条款1:视C++为一个语言联邦

书中提到了应该视C++拥有4个次语言:
1. C
1. Object-Oriented C++
1. Template C++
1. STL

第1点当然很容易理解，C++兼容C的语法，并且可以直接使用C的库，但是在笔者的观点上看，使用C++更多的是为了第2点，理由稍后描述。而在笔者的编程经历上看，很少(除了用VC写C)用C++写纯C语言项目，尤其是在`Linux`下。举个`Socket`编程的例子，用`C`的话一般这么写:
``` c
int fd = socket(AF_INET, SOCK_STREAM, 0);

if(fd < 0)
{
	// 做一些申请失败的处理代码，如果程序不能离开这个资源的话，甚至需要退出整个程序。
}
```
这里一小段还好，如果是写服务器端的代码的话，用到`bind`、`listen`、`accept`等函数，每次调用完之后都要判断返回值，后续还有设置其他参数等，这样的代码组织方面不会说出大的问题，但是不雅观。那么用`C++`一般是这么写的:
``` c++
Socket socket(8080);
```
当然`Socket`类里面封装的代码大体还是跟原来的`C`部分相同，这里用到的是第2点中的`封装`性质，但是这里又出一个问题了，原来的`C`代码中，每一步一旦申请资源失败都可以在调用者方进行处理;进行了封装之后，中间的过程申请资源失败了，那么该怎么处理？是在本函数体内处理完异常？还是返回错误信息给调用者？如果是内部处理异常的话，那么发生了调用者不期望的行为，而调用者放心地把所有问题交给了封装好的对象，那么调用者不理会的话，程序会因为严重错误而终止运行;如果是返回错误信息给调用者的话，那么这个封装的意义何在？所以有的论调是用`C++`不如用`C`进行项目开发，除了平添开销之外没有好处，从上述的例子上看多少有点道理。但是看看隔壁的`Java`面向对象风生水起，证明了面向对象的开发可以大大提高软件的开发效率(注意是开发效率)。总之就是见仁见智吧。

第3点是`Template C++`，泛型编程，为了减少代码的重复而存在，例如大小的比较，总不可能一个int就写一个专门的int型比较函数，一个float型就写一个专门的float型比较函数吧。当然这只是基础的背景，事实上泛型编程有更多的应用，学习难度更高，例如泛型元编程(template metaprogramming)，然而笔者还没在应用中见识过这样的东西，一般都是做着实验玩的居多。

第4点是标准模板库(STL,Standard Template Library)，其实就是把经典的数据结构及其算法集成在语言基础库中，也是为了减少代码的重复，不然一个项目重新做一个轮子，这样的时间耗费基本没有意义。STL提供的库可以显著地改变代码风格，其中的`迭代器(Iterator)`是一个很重要的概念，用了STL提供的概念之后，自己实现的代码中很可能都不需要写任何算法方面的代码，也没有循环的存在，有可能两三句就把一个功能完成了。

## 条款2:尽量以const,enum,inline替换#define

这一条款书上提供了具体的例子，`#define`定义的常量不计入符号表，到时报错的时候很可能就是一个简单的数值，这让开发者无从着手调试。而用`const`定义的常量，一是具有类型，不怕使用者错误地使用这个常量值;二是这样定义的常量记入符号表，这样编译报错起码之后错了的变量名。

（待续）